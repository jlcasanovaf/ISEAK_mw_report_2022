-------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  E:\Jorgec\ISEAK mw report 2022\00. Data processing\00. MCVL\log\03. Estimate h
> ourly wages 20230122.log
  log type:  text
 opened on:  22 Jan 2023, 23:20:56

. 
.         
. ********************************************************************************
. * C. Load and merge the data
. ********************************************************************************
.         
.         * Cutoff dates
.         use "$dta\_AUX. Cutoff dates.dta", clear

.         
.         reshape long date, i(m) j(t)
(note: j = 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                        1   ->      24
Number of variables                  25   ->       3
j variable (24 values)                    ->   t
xij variables:
                 date1 date2 ... date24   ->   date
-----------------------------------------------------------------------------

.         
.         drop m

.         
.         sort t

.         tempfile dates

.         save `dates', replace
(note: file C:\PROGRA~3\Temp\STATA-~1\JORGE_~1\ST_2be0_000001.tmp not found)
file C:\PROGRA~3\Temp\STATA-~1\JORGE_~1\ST_2be0_000001.tmp saved

.         
.         * MCVL data
.         use "$dta\01. Harmonised affiliation data.dta", clear   

.                 
.                 keep identpers identccc2 falta fbaja coefparc t

.                 
.                 merge 1:1 identpers identccc2 t using "$dta/02. Harmonized Contribution b
> asis.dta", keep(1 3) nogen keepusing(base)

    Result                           # of obs.
    -----------------------------------------
    not matched                     3,940,281
        from master                 3,940,281  
        from using                          0  

    matched                        12,155,319  
    -----------------------------------------

.                 merge 1:1 identpers identccc2 t using "$dta/02. Harmonized Contribution b
> asis special regime.dta", keep(1 4) nogen keepusing(base) replace update                 
>       

    Result                           # of obs.
    -----------------------------------------
    not matched                    15,677,182
        from master                15,677,182  
        from using                          0  

    matched                           418,418
        not updated                         0  
        missing updated               418,418  
        nonmissing conflict                 0  
    -----------------------------------------

.                 
.                 sort t

.                 merge m:1 t using `dates', nogen

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                        16,095,600  
    -----------------------------------------

.                 
. ********************************************************************************
. * D. Estimate hourly wages
. ********************************************************************************         
>        
.         
.         * Number of days worked
.         gen t_lb = mdy(month(date), 1, year(date))

.         gen t_ub = mdy(month(date), day(mdy(month(date)+1,1,year(date))-1), year(date)) i
> f month(date) < 12
(1,341,300 missing values generated)

.         replace t_ub = mdy(12, 31, year(date)) if month(date) == 12
(1,341,300 real changes made)

.         
.         replace t_lb = falta if t_lb < falta & !mi(falta)
(332,755 real changes made)

.         replace t_ub = fbaja if t_lb > fbaja    
(0 real changes made)

.         
.         gen days_worked = t_ub - t_lb + 1

.         assert days_worked <= 31

.         
.         * Number of hours worked per day
.         gen hours_worked = 8 if coefparc == 0
(6,900,641 missing values generated)

.         replace hours_worked = 8*coefparc/1000 if coefparc != 0
(2,248,750 real changes made)

.         assert mi(hours_worked) | hours_worked > 0

.         
.         * Hourly wages
.         gen hourly_wages = base / (days_worked * hours_worked) 
(4,657,691 missing values generated)

.         
.         compress
  variable date was float now int
  variable t_lb was float now int
  variable t_ub was float now int
  variable days_worked was float now byte
  (144,860,400 bytes saved)

.         
.         * Fix weird cases with negative wages but employed in that period ()
.         assert identpers == "19935M0VH340100" if base < 0

.         replace base = -base if base < 0
(1 real change made)

.         replace hourly_wages = -hourly_wages if hourly_wages < 0
(1 real change made)

.         
.         * Set base and hourly wage to zero when, even employed, it does not receive a mon
> thly wage
.         replace base = . if base == 0
(3,848 real changes made, 3,848 to missing)

.         replace hourly_wage = . if hourly_wage == 0
(3,826 real changes made, 3,826 to missing)

.         
.         * Keep relevant variables
.         drop t_lb t_ub

.         
.         sort identpers identccc2 t

.         save "$dta/03. Hourly wages.dta", replace
file E:\Jorgec\ISEAK mw report 2022\00. Data processing\00. MCVL\dta/03. Hourly wages.dta s
> aved

.                 
. * End of this dofile
. cap log close
