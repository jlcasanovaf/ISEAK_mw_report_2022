-------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  E:\Jorgec\ISEAK mw report 2022\01. Descriptives\log\00. Replicate descriptives
>  20230127.log
  log type:  text
 opened on:  27 Jan 2023, 23:33:47

. 
.         
. ********************************************************************************
. * C. Load and prepare the data
. ********************************************************************************
.         
.         use "$dta/99. Consolidated data.dta", clear     

. 
.         gen one_18 = hourly_wages if employed == 1 & year(date) == 2018 & month(date) == 
> 11
(14,739,853 missing values generated)

.         gen one_19 = hourly_wages if employed == 1 & year(date) == 2019 & month(date) == 
> 1
(14,743,922 missing values generated)

.         gen one_19_nov = hourly_wages if employed == 1 & year(date) == 2019 & month(date)
>  == 11
(14,733,827 missing values generated)

.         
.         gen year = year(date)

.         
. ********************************************************************************
. * D. Load and prepare the data
. ********************************************************************************        
.         
.         preserve

.         
.                 keep if !mi(one_18) | !mi(one_19) 
(14,294,799 observations deleted)

.                 
.                         # d;
delimiter now ;
.                         twoway (hist one_18, width(0.1) freq bcolor(navy%60)) 
>                                         (hist one_19, width(0.1) freq bcolor(none) fcolor
> (none) bcolor(red%70)) 
>                                         if hourly_wages <= 6, 
>                                         xlabel(0(1)6) 
>                                         ylabel(0 "0" 5000 "125" 10000 "250" 15000 "375" 2
> 0000 "500",format(%12,0fc)) // Extrapolate 4% sample
>                                         graphregion(color(white))
>                                         xtitle("Salario/hora")
>                                         ytitle("Personas (en miles)")
>                                         legend(order(1 "2018" 2 "2019") r(2) ring(0) posi
> tion(10) nobox
>                                         region(lstyle(none) color(none)));

.                         #d cr
delimiter now cr
.                         graph export "$out\Figure 2.png", replace
(file E:\Jorgec\ISEAK mw report 2022\01. Descriptives\out\Figure 2.png written in PNG forma
> t)

.                         
.                         # d;
delimiter now ;
.                         twoway (hist one_18, width(0.1) freq bcolor(navy%60)) 
>                                         (hist one_19, width(0.1) freq bcolor(none) fcolor
> (none) bcolor(red%70)) 
>                                         if hourly_wages <= 6 & ft == 1, 
>                                         xlabel(0(1)6) 
>                                         ylabel(0 "0" 5000 "125" 10000 "250" 15000 "375" 2
> 0000 "500",format(%12,0fc)) // Extrapolate 4% sample
>                                         graphregion(color(white))
>                                         xtitle("Salario/hora")
>                                         ytitle("Personas (en miles)")
>                                         legend(order(1 "2018" 2 "2019") r(2) ring(0) posi
> tion(10) nobox
>                                         region(lstyle(none) color(none)));

.                         #d cr
delimiter now cr
.                         graph export "$out\Figure 3A.png", replace              
(file E:\Jorgec\ISEAK mw report 2022\01. Descriptives\out\Figure 3A.png written in PNG form
> at)

.                         
.                         # d;
delimiter now ;
.                         twoway (hist one_18, width(0.1) freq bcolor(navy%60)) 
>                                         (hist one_19, width(0.1) freq bcolor(none) fcolor
> (none) bcolor(red%70)) 
>                                         if hourly_wages <= 6 & ft == 0, 
>                                         xlabel(0(1)6) 
>                                         ylabel(0 "0" 5000 "125" 10000 "250" 15000 "375" 2
> 0000 "500",format(%12,0fc)) // Extrapolate 4% sample
>                                         graphregion(color(white))
>                                         xtitle("Salario/hora")
>                                         ytitle("Personas (en miles)")
>                                         legend(order(1 "2018" 2 "2019") r(2) ring(0) posi
> tion(10) nobox
>                                         region(lstyle(none) color(none)));

.                         #d cr
delimiter now cr
.                         graph export "$out\Figure 3B.png", replace                       
>        
(file E:\Jorgec\ISEAK mw report 2022\01. Descriptives\out\Figure 3B.png written in PNG form
> at)

.                 
.                 restore

.                 
. ********************************************************************************
. * D. Table 1
. ********************************************************************************         
>                
.         
.         foreach var in gcnae sexo edad_cat nworkers {
  2.                 
.                 preserve
  3.                 
.                         keep if !mi(one_18) | !mi(one_19) 
  4.                 
.                         drop gcnae_str
  5.                         keep if !mi(one_18)
  6.                 
.                         cap drop str_`var'
  7.                         decode `var',gen(str_`var')
  8.                         qui levelsof str_`var' if !mi(str_`var'),local(cats)
  9.                         local n_val = r(r)
 10.                         
.                         local x = 1
 11.                         foreach cat of local cats {
 12.                                 
.                                 local cat`x' = "`cat'"
 13.                                 
.                                 qui count if hourly_wages < 4.375 & str_`var' == "`cat'" 
 14.                                 local `var'`x' = r(N)
 15.                                 
.                                 qui count if str_`var' == "`cat'"
 16.                                 local `var'_tot`x' = r(N)
 17.                                 
.                                 local share`x' = ``var'`x'' / ``var'_tot`x''
 18.                                 
.                                 local x = `x' + 1
 19.                         }
 20.                         
.                         clear
 21.                         set obs `n_val'
 22.                         gen category = ""
 23.                         gen freq = .
 24.                         gen freq_tot = .
 25.                         gen share = .
 26.                         
.                         forval x = 1/`n_val' {
 27.                                 replace category = "`cat`x''" in `x'
 28.                                 replace freq = ``var'`x'' in `x'
 29.                                 replace freq_tot = ``var'_tot`x'' in `x'
 30.                                 replace share = `share`x'' in `x'
 31.                         }
 32.                         
.                         tempfile `var'
 33.                         save ``var'', replace   
 34.                                 
.                 restore
 35.         }
(14,294,799 observations deleted)
(445,054 observations deleted)
number of observations (_N) was 0, now 14
(14 missing values generated)
(14 missing values generated)
(14 missing values generated)
(14 missing values generated)
variable category was str1 now str22
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
variable category was str22 now str38
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
variable category was str38 now str59
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(note: file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_000003.tmp not found)
file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_000003.tmp saved
(14,294,799 observations deleted)
(445,054 observations deleted)
number of observations (_N) was 0, now 2
(2 missing values generated)
(2 missing values generated)
(2 missing values generated)
(2 missing values generated)
variable category was str1 now str6
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(note: file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_000005.tmp not found)
file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_000005.tmp saved
(14,294,799 observations deleted)
(445,054 observations deleted)
number of observations (_N) was 0, now 5
(5 missing values generated)
(5 missing values generated)
(5 missing values generated)
(5 missing values generated)
variable category was str1 now str11
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
variable category was str11 now str16
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(note: file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_000007.tmp not found)
file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_000007.tmp saved
(14,294,799 observations deleted)
(445,054 observations deleted)
number of observations (_N) was 0, now 4
(4 missing values generated)
(4 missing values generated)
(4 missing values generated)
(4 missing values generated)
variable category was str1 now str10
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
variable category was str10 now str11
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(note: file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_000009.tmp not found)
file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_000009.tmp saved

.         
.         preserve

.                 clear

.                 foreach var in sexo edad_cat nworkers gcnae {   
  2.                 append using ``var''
  3.                 }
(note: variable category was str6, now str16 to accommodate using data's values)
(note: variable category was str16, now str59 to accommodate using data's values)

.                 
.                 export excel "$out\Table 1.xlsx", sheetreplace sheet("raw") first(var)
file E:\Jorgec\ISEAK mw report 2022\01. Descriptives\out\Table 1.xlsx saved

.         restore

.         
. ********************************************************************************
. * D. Table 2
. ********************************************************************************         
>                        
. 
.         foreach type in all smi men women{
  2. 
.         foreach var in gcnae sexo edad_cat nworkers {
  3.         
.                 preserve
  4.                 
.                         keep if !mi(one_18) | !mi(one_19) 
  5.                         
.                         drop gcnae_str
  6.                         keep if !mi(one_18)
  7.                         
.                         if "`type'" == "all" {
  8.                                 local filter ""
  9.                                 qui count
 10.                                 local total = r(N)
 11.                         }
 12.                         if "`type'" == "smi" {
 13.                                 local filter "hourly_wages < 4.375 & "
 14.                                 qui count if hourly_wages < 4.375
 15.                                 local total = r(N)              
 16.                         }
 17.                         if "`type'" == "men" {
 18.                                 local filter "hourly_wages < 4.375 & sexo == 0 & "
 19.                                 qui count if hourly_wages < 4.375 & sexo == 0
 20.                                 local total = r(N)                                    
>           
 21.                         }
 22.                         if "`type'" == "women" {
 23.                                 local filter "hourly_wages < 4.375 & sexo == 1 & "
 24.                                 qui count if hourly_wages < 4.375 & sexo == 1
 25.                                 local total = r(N)                                    
>                                           
 26.                         }
 27.                         
.                         cap drop str_`var'                      
 28.                         decode `var',gen(str_`var')
 29.                         qui levelsof str_`var' if !mi(str_`var'),local(cats)
 30.                         local n_val = r(r)
 31.                         
.                         local x = 1
 32.                         foreach cat of local cats {
 33.                                 
.                                 local cat`x' = "`cat'"
 34.                                 
.                                 qui count if `filter' str_`var' == "`cat'" 
 35.                                 local `var'`x' = r(N)/`total'
 36.                                 local x = `x' + 1                               
 37.                         }
 38.                         
.                         clear
 39.                         set obs `n_val'
 40.                         gen category = ""
 41.                         gen `type' = .
 42.                         
.                         forval x = 1/`n_val' {
 43.                                 replace category = "`cat`x''" in `x'
 44.                                 replace `type' = ``var'`x'' in `x'
 45.                         }
 46.                         
.                         sort category
 47.                         
.                         tempfile `var'
 48.                         save ``var'', replace   
 49.                                 
.                 restore
 50.         }
 51.         
.         preserve
 52.         
.                 clear
 53.                 foreach var in sexo edad_cat nworkers gcnae {   
 54.                 append using ``var''
 55.                 }
 56.                 
.                 tempfile `type'
 57.                 save ``type'', replace
 58.         
.         restore
 59.         
.         }
(14,294,799 observations deleted)
(445,054 observations deleted)
number of observations (_N) was 0, now 14
(14 missing values generated)
(14 missing values generated)
variable category was str1 now str22
(1 real change made)
(1 real change made)
variable category was str22 now str38
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
variable category was str38 now str59
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(note: file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_00000c.tmp not found)
file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_00000c.tmp saved
(14,294,799 observations deleted)
(445,054 observations deleted)
number of observations (_N) was 0, now 2
(2 missing values generated)
(2 missing values generated)
variable category was str1 now str6
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(note: file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_00000e.tmp not found)
file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_00000e.tmp saved
(14,294,799 observations deleted)
(445,054 observations deleted)
number of observations (_N) was 0, now 5
(5 missing values generated)
(5 missing values generated)
variable category was str1 now str11
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
variable category was str11 now str16
(1 real change made)
(1 real change made)
(note: file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_00000g.tmp not found)
file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_00000g.tmp saved
(14,294,799 observations deleted)
(445,054 observations deleted)
number of observations (_N) was 0, now 4
(4 missing values generated)
(4 missing values generated)
variable category was str1 now str10
(1 real change made)
(1 real change made)
variable category was str10 now str11
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(note: file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_00000i.tmp not found)
file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_00000i.tmp saved
(note: variable category was str6, now str16 to accommodate using data's values)
(note: variable category was str16, now str59 to accommodate using data's values)
(note: file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_00000k.tmp not found)
file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_00000k.tmp saved
(14,294,799 observations deleted)
(445,054 observations deleted)
number of observations (_N) was 0, now 14
(14 missing values generated)
(14 missing values generated)
variable category was str1 now str22
(1 real change made)
(1 real change made)
variable category was str22 now str38
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
variable category was str38 now str59
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(note: file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_00000m.tmp not found)
file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_00000m.tmp saved
(14,294,799 observations deleted)
(445,054 observations deleted)
number of observations (_N) was 0, now 2
(2 missing values generated)
(2 missing values generated)
variable category was str1 now str6
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(note: file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_00000o.tmp not found)
file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_00000o.tmp saved
(14,294,799 observations deleted)
(445,054 observations deleted)
number of observations (_N) was 0, now 5
(5 missing values generated)
(5 missing values generated)
variable category was str1 now str11
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
variable category was str11 now str16
(1 real change made)
(1 real change made)
(note: file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_00000q.tmp not found)
file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_00000q.tmp saved
(14,294,799 observations deleted)
(445,054 observations deleted)
number of observations (_N) was 0, now 4
(4 missing values generated)
(4 missing values generated)
variable category was str1 now str10
(1 real change made)
(1 real change made)
variable category was str10 now str11
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(note: file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_00000s.tmp not found)
file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_00000s.tmp saved
(note: variable category was str6, now str16 to accommodate using data's values)
(note: variable category was str16, now str59 to accommodate using data's values)
(note: file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_00000u.tmp not found)
file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_00000u.tmp saved
(14,294,799 observations deleted)
(445,054 observations deleted)
number of observations (_N) was 0, now 14
(14 missing values generated)
(14 missing values generated)
variable category was str1 now str22
(1 real change made)
(1 real change made)
variable category was str22 now str38
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
variable category was str38 now str59
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(note: file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_00000w.tmp not found)
file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_00000w.tmp saved
(14,294,799 observations deleted)
(445,054 observations deleted)
number of observations (_N) was 0, now 2
(2 missing values generated)
(2 missing values generated)
variable category was str1 now str6
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(note: file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_000010.tmp not found)
file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_000010.tmp saved
(14,294,799 observations deleted)
(445,054 observations deleted)
number of observations (_N) was 0, now 5
(5 missing values generated)
(5 missing values generated)
variable category was str1 now str11
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
variable category was str11 now str16
(1 real change made)
(1 real change made)
(note: file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_000012.tmp not found)
file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_000012.tmp saved
(14,294,799 observations deleted)
(445,054 observations deleted)
number of observations (_N) was 0, now 4
(4 missing values generated)
(4 missing values generated)
variable category was str1 now str10
(1 real change made)
(1 real change made)
variable category was str10 now str11
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(note: file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_000014.tmp not found)
file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_000014.tmp saved
(note: variable category was str6, now str16 to accommodate using data's values)
(note: variable category was str16, now str59 to accommodate using data's values)
(note: file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_000016.tmp not found)
file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_000016.tmp saved
(14,294,799 observations deleted)
(445,054 observations deleted)
number of observations (_N) was 0, now 14
(14 missing values generated)
(14 missing values generated)
variable category was str1 now str22
(1 real change made)
(1 real change made)
variable category was str22 now str38
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
variable category was str38 now str59
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(note: file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_000018.tmp not found)
file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_000018.tmp saved
(14,294,799 observations deleted)
(445,054 observations deleted)
number of observations (_N) was 0, now 2
(2 missing values generated)
(2 missing values generated)
variable category was str1 now str6
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(note: file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_00001a.tmp not found)
file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_00001a.tmp saved
(14,294,799 observations deleted)
(445,054 observations deleted)
number of observations (_N) was 0, now 5
(5 missing values generated)
(5 missing values generated)
variable category was str1 now str11
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
variable category was str11 now str16
(1 real change made)
(1 real change made)
(note: file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_00001c.tmp not found)
file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_00001c.tmp saved
(14,294,799 observations deleted)
(445,054 observations deleted)
number of observations (_N) was 0, now 4
(4 missing values generated)
(4 missing values generated)
variable category was str1 now str10
(1 real change made)
(1 real change made)
variable category was str10 now str11
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(note: file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_00001e.tmp not found)
file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_00001e.tmp saved
(note: variable category was str6, now str16 to accommodate using data's values)
(note: variable category was str16, now str59 to accommodate using data's values)
(note: file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_00001g.tmp not found)
file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_00001g.tmp saved

.         
.         preserve

.                 
.                 use `all', clear

.                 
.                 foreach type in smi men women{  
  2.                         sort category
  3.                         merge 1:1 category using ``type'', nogen keep(3)
  4.                 }

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                                25  
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                                25  
    -----------------------------------------

    Result                           # of obs.
    -----------------------------------------
    not matched                             0
    matched                                25  
    -----------------------------------------

.                 
.                 export excel "$out\Table 2.xlsx", sheetreplace sheet("raw") first(var)
file E:\Jorgec\ISEAK mw report 2022\01. Descriptives\out\Table 2.xlsx saved

.         
.         restore

. 
.         
. ********************************************************************************
. * E. Graph 4
. ********************************************************************************         
>                                
.         
.         preserve

.                 
.                 keep if !mi(one_18) | !mi(one_19) 
(14,294,799 observations deleted)

.         
.                 drop gcnae_str

.                 keep if !mi(one_18)
(445,054 observations deleted)

.                         
.                 gen affected = (hourly_wages > 3.57 & hourly_wages < 4.375)

.                 gen all = 1

.                 gen men = (sexo == 0)

.                 gen women = (sexo == 1)

.                 gen nacional = (espanol == 1)

.                 gen foreign = (espanol == 0)

.                 gen less_30 = (edad <= 30)

.                 gen more_30 = (edad > 30)

. 
.                 foreach type in all men women nacional foreign less_30 more_30 {
  2.                         qui sum hourly_wages if `type' == 1 & affected == 1
  3.                         local `type' = (r(mean)/4.375)*100
  4.                 }

. 
.                 clear 

.                 set obs 7
number of observations (_N) was 0, now 7

.                 gen category = "Total" in 1
(6 missing values generated)

.                 replace category = "Hombres" in 2
variable category was str5 now str7
(1 real change made)

.                 replace category = "Mujeres" in 3
(1 real change made)

.                 replace category = "Nacionales" in 4
variable category was str7 now str10
(1 real change made)

.                 replace category = "Extranjeros" in 5
variable category was str10 now str11
(1 real change made)

.                 replace category = "<=30" in 6
(1 real change made)

.                 replace category = ">30" in 7
(1 real change made)

. 
.                 encode category, gen(category_n)

. 
.                 gen value = `all' in 1
(6 missing values generated)

.                 replace value = `men' in 2 
(1 real change made)

.                 replace value = `women' in 3 
(1 real change made)

.                 replace value = `nacional' in 4
(1 real change made)

.                 replace value = `foreign' in 5
(1 real change made)

.                 replace value = `less_30' in 6
(1 real change made)

.                 replace value = `more_30' in 7
(1 real change made)

. 
.                 gen mylabel = string(value, "%10,1fc")

. 
.                 local smi18 = (3.57/4.375)*100

. 
.                 # delimit;
delimiter now ;
.                         twoway (scatter value category_n if category == "Total", color(na
> vy) mlabel(mylabel) mlabcolor(black) mlabpos(6)) 
>                         (scatter value category_n if category == "Hombres", color(navy) m
> label(mylabel) mlabcolor(black) mlabpos(6))
>                         (scatter value category_n if category == "Mujeres", color(navy) m
> label(mylabel) mlabcolor(black) mlabpos(6)) 
>                         (scatter value category_n if category == "Nacionales", color(navy
> ) mlabel(mylabel) mlabcolor(black) mlabpos(6)) 
>                         (scatter value category_n if category == "Extranjeros", color(nav
> y) mlabel(mylabel) mlabcolor(black) mlabpos(6)) 
>                         (scatter value category_n if category == "<=30", color(navy) mlab
> el(mylabel) mlabcolor(black) mlabpos(6)) 
>                         (scatter value category_n if category == ">30", color(navy) mlabe
> l(mylabel) mlabcolor(black) mlabpos(6)),
>                         xlabel(1 "Total" 2 "Hombres" 3 "Mujeres" 4 "Nacionales" 5 "Extran
> jeros" 6 "<=30" 7 ">30", labsize(small))
>                         xtitle("")
>                         ytitle("%")
>                         yline(`smi18', lpat(dash) lcolor(red))
>                         ylabel(80(10)100, labsize(small))
>                         legend(off)
>                         graphregion(color(white));

.                 # delimit cr
delimiter now cr
.                 graph export "$out\Figure 4.png", replace
(file E:\Jorgec\ISEAK mw report 2022\01. Descriptives\out\Figure 4.png written in PNG forma
> t)

. 
.         restore

. 
. ********************************************************************************
. * F. Graph 5
. ********************************************************************************         
>                                        
.         
.         preserve

.                 
.                 keep if !mi(one_18) | !mi(one_19) 
(14,294,799 observations deleted)

.         
.                 drop gcnae_str

.                 keep if !mi(one_18)
(445,054 observations deleted)

.                 
.                 gen affected = (hourly_wages > 3.57 & hourly_wages < 4.375)

.                 gen all = 1

.                 gen men = (sexo == 0)

.                 gen women = (sexo == 1)

.                 gen nacional = (espanol == 1)

.                 gen foreign = (espanol == 0)

.                 gen less_30 = (edad <= 30)

.                 gen more_30 = (edad > 30)

.         
.                 foreach type in all men women nacional foreign less_30 more_30 {
  2.                         
.                         local x = 1
  3.                         foreach num of numlist 3.6(0.1)4.4 {
  4.                                 
.                                 local num2 = `num' + 0.1
  5.                                 
.                                 qui count if `type' == 1 & hourly_wages >= 3.6 & hourly_w
> ages < 4.5
  6.                                 local `type'_tot`x' = r(N)
  7.                                 
.                                 qui count if `type' == 1 & hourly_wages >= `num' & hourly
> _wages < `num2'
  8.                                 local `type'`x' = (r(N)/``type'_tot`x'')*100
  9.                                 
.                                 local x = `x' + 1
 10. 
.                         }                                                                
>                                                                                          
>       
 11.                 }       

.                 
.                 clear 

.                 set obs 7
number of observations (_N) was 0, now 7

.                 gen category = "all" in 1
(6 missing values generated)

.                 replace category = "men" in 2
(1 real change made)

.                 replace category = "women" in 3
variable category was str3 now str5
(1 real change made)

.                 replace category = "nacional" in 4
variable category was str5 now str8
(1 real change made)

.                 replace category = "foreign" in 5
(1 real change made)

.                 replace category = "less_30" in 6
(1 real change made)

.                 replace category = "more_30" in 7
(1 real change made)

. 
.                 encode category, gen(category_n)

.         
.                 expand 9
(56 observations created)

.                 bys category: gen range = _n

. 
.                 gen value = . 
(63 missing values generated)

.                 foreach type in all men women nacional foreign less_30 more_30 {
  2.                 
.                         forval x = 1/9 {
  3.                         
.                                 replace value = ``type'`x'' if category == "`type'" & ran
> ge == `x'
  4.                         
.                         }       
  5.                 }
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)
(1 real change made)

.                 
.                 # delimit;
delimiter now ;
.                         twoway (scatter value range if category == "men", mfcolor(none) m
> lcolor(blue) msymbol(O)) 
>                         (scatter value range if category == "women", mfcolor(none) mlcolo
> r(green) msymbol(T)),
>                         xlabel(1 "3.6" 2 "3.7" 3 "3.8" 4 "3.9" 5 "4" 6 "4.1" 7 "4.2" 8 "4
> .3" 9 "4.4", labsize(small))
>                         xtitle("Salario/hora")
>                         ytitle("%")
>                         ylabel(0(7)28, labsize(small))
>                         graphregion(color(white))
>                         legend(order(1 "Hombres" 2 "Mujeres") r(2) ring(0) position(1) no
> box
>                         region(lstyle(none) color(none)));

.                 # delimit cr
delimiter now cr
.                 graph export "$out\Figure 5A.png", replace              
(file E:\Jorgec\ISEAK mw report 2022\01. Descriptives\out\Figure 5A.png written in PNG form
> at)

.                 
.                 # delimit;
delimiter now ;
.                         twoway (scatter value range if category == "nacional", mfcolor(no
> ne) mlcolor(green) msymbol(O)) 
>                         (scatter value range if category == "foreign", mfcolor(none) mlco
> lor(red) msymbol(T)),
>                         xlabel(1 "3.6" 2 "3.7" 3 "3.8" 4 "3.9" 5 "4" 6 "4.1" 7 "4.2" 8 "4
> .3" 9 "4.4", labsize(small))
>                         xtitle("Salario/hora")
>                         ytitle("%")
>                         ylabel(0(7)28, labsize(small))
>                         graphregion(color(white))
>                         legend(order(1 "Nacional" 2 "Extranjero") r(2) ring(0) position(1
> ) nobox
>                         region(lstyle(none) color(none)));

.                 # delimit cr
delimiter now cr
.                 graph export "$out\Figure 5B.png", replace              
(file E:\Jorgec\ISEAK mw report 2022\01. Descriptives\out\Figure 5B.png written in PNG form
> at)

.                 
.                 
.                 # delimit;
delimiter now ;
.                         twoway (scatter value range if category == "less_30", mfcolor(non
> e) mlcolor(blue) msymbol(O)) 
>                         (scatter value range if category == "more_30", mfcolor(none) mlco
> lor(gold) msymbol(T)),
>                         xlabel(1 "3.6" 2 "3.7" 3 "3.8" 4 "3.9" 5 "4" 6 "4.1" 7 "4.2" 8 "4
> .3" 9 "4.4", labsize(small))
>                         xtitle("Salario/hora")
>                         ytitle("%")
>                         ylabel(0(7)28, labsize(small))
>                         graphregion(color(white))
>                         legend(order(1 "<= 30 años" 2 ">30 años") r(2) ring(0) position(1
> ) nobox
>                         region(lstyle(none) color(none)));

.                 # delimit cr
delimiter now cr
.                 graph export "$out\Figure 5C.png", replace                              
(file E:\Jorgec\ISEAK mw report 2022\01. Descriptives\out\Figure 5C.png written in PNG form
> at)

. 
.         restore

.         
. ********************************************************************************
. * G. Graph 6
. ********************************************************************************         
>                                                
.         
.         preserve

.         
.                 keep if !mi(one_18) | !mi(one_19_nov) 
(14,284,704 observations deleted)

.                 
.                         # d;
delimiter now ;
.                         twoway (hist one_18, width(0.1) freq bcolor(navy%60)) 
>                                         (hist one_19_nov, width(0.1) freq bcolor(none) fc
> olor(none) bcolor(red%70))     
>                                         if hourly_wages <= 15, 
>                                         xlabel(0(1)15) 
>                                         ylabel(0 "0" 5000 "125" 10000 "250" 15000 "375" 2
> 0000 "500",format(%12,0fc)) // Extrapolate 4% sample
>                                         graphregion(color(white))
>                                         xtitle("Salario/hora")
>                                         ytitle("Personas (en miles)")
>                                         legend(order(1 "2018" 2 "2019") r(2) ring(0) posi
> tion(1) nobox
>                                         region(lstyle(none) color(none)));

.                         #d cr
delimiter now cr
.                         graph export "$out\Figure 6.png", replace       
(file E:\Jorgec\ISEAK mw report 2022\01. Descriptives\out\Figure 6.png written in PNG forma
> t)

.         
.         restore

.         
. ********************************************************************************
. * G. Graph 12
. ********************************************************************************         
>                                                                
.         
.         preserve

.         
.                 keep if !mi(one_18)
(14,739,853 observations deleted)

.                 
.                         # d;
delimiter now ;
.                         twoway (hist one_18, width(0.1) freq bcolor(navy%60)) 
>                                         if hourly_wages <= 6, 
>                                         xlabel(0(1)6) 
>                                         ylabel(0 "0" 5000 "125" 10000 "250" 15000 "375",f
> ormat(%12,0fc)) // Extrapolate 4% sample
>                                         graphregion(color(white))
>                                         xtitle("Salario/hora")
>                                         ytitle("Personas (en miles)")
>                                         xline(4.39, lcolor(orange))
>                                         xline(5.47, lcolor(orange))
>                                         xline(3.57, lcolor(navy%60))
>                                         xline(4.375, lcolor(navy%60))
>                                         ttext(13000 4 "Grupo de" "tratamiento", size(smal
> l) color(navy))
>                                         ttext(13000 5 "Grupo de" "control", size(small) c
> olor(orange))                          
>                                         legend(off);

.                         #d cr
delimiter now cr
.                         graph export "$out\Figure 12.png", replace      
(file E:\Jorgec\ISEAK mw report 2022\01. Descriptives\out\Figure 12.png written in PNG form
> at)

. 
.         restore

. 
. ********************************************************************************
. * H. Graph 7
. ********************************************************************************         
>                                                                        
.         
.         preserve

.         
.                 keep if !mi(one_18) | !mi(one_19_nov) 
(14,284,704 observations deleted)

.                 
.                 gen one = 1

. 
.                 
.                 gen delta = .
(904,272 missing values generated)

.         
.                         local x = 1

.                         foreach num of numlist 0(0.1)14.9 {
  2.                                 
.                                 local num2 = `num' + 0.1
  3.                                         
.                                 qui replace delta = `num' if hourly_wages >= `num' & hour
> ly_wages < `num2'
  4.                         }

. 
.                 gen cum_w = hourly_wages * hours_worked

.         
.                 collapse (sum) one cum_w , by(year delta)

.                 
.                 reshape wide one cum_w, i(delta) j(year)
(note: j = 2018 2019)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                      302   ->     151
Number of variables                   4   ->       5
j variable (2 values)              year   ->   (dropped)
xij variables:
                                    one   ->   one2018 one2019
                                  cum_w   ->   cum_w2018 cum_w2019
-----------------------------------------------------------------------------

.                 
.                 egen total2018 = total(one2018)

.                 egen totalw2018 = total(cum_w2018)              

.                 
.                 gen varemp = 100*((one2019-one2018)/total2018)          

.                 gen cumemp = 100*(sum(one2019-one2018)/total2018)

.                 gen cumw = 100*(sum(cum_w2019-cum_w2018)/totalw2018)

.                 
.                 # d;
delimiter now ;
.                 twoway (bar varemp delta, barw(0.07) bcolor(blue)) 
>                                 (line cumemp delta, color(orange))
>                                 (line cumw delta, color(green)), 
>                                 ylabel(-8(2)6, labsize(small)) 
>                                 xlabel(0(1)15,format(%12,0fc) labsize(vsmall)) // Extrapo
> late 4% sample
>                                 graphregion(color(white))
>                                 xtitle("Salario/hora", size(small))
>                                 ytitle("Cambio con respecto a 2018 (%)", size(small))
>                                 legend(order(1 "Personas asalariadas" 2 "Personas asalari
> adas (acumulado)" 3 "Masa salarial (acumulado)") size(small) r(3) ring(0) position(4) nob
> ox
>                                 region(lstyle(none) color(none)));

.                 #d cr           
delimiter now cr
.                 graph export "$out\Figure 7.png", replace
(file E:\Jorgec\ISEAK mw report 2022\01. Descriptives\out\Figure 7.png written in PNG forma
> t)

.                 
.         restore

.         
. ********************************************************************************
. * I. Graph 8
. ********************************************************************************         
>                                                                        
.         
.         preserve

.         
.                 keep if !mi(one_18) | !mi(one_19_nov)   
(14,284,704 observations deleted)

.                                 
.                 forval x = 2018/2019 {
  2.                         qui sum base if year == `x',d
  3.                         global qmed_`x' = r(c_5)                
  4. 
.                         centile base if year == `x' & base < ${qmed_`x'}, c(20 40 60 80)
  5.                         
.                         global q1_`x' = r(c_1)
  6.                         global q2_`x' = r(c_2)
  7.                         global q3_`x' = r(c_3)
  8.                         global q4_`x' = r(c_4)  
  9.                         
.                 }

                                                       -- Binom. Interp. --
    Variable |       Obs  Percentile    Centile        [95% Conf. Interval]
-------------+-------------------------------------------------------------
        base |   449,123         20    1013.732         1009.97    1016.968
             |                   40    1432.136         1429.33     1434.46
             |                   60    1876.784         1872.33    1881.407
             |                   80     2764.26        2758.132     2771.32

                                                       -- Binom. Interp. --
    Variable |       Obs  Percentile    Centile        [95% Conf. Interval]
-------------+-------------------------------------------------------------
        base |   455,149         20      1057.8         1054.61    1059.915
             |                   40     1465.75        1463.078      1466.4
             |                   60     1919.79         1916.67    1924.184
             |                   80     2833.34        2827.055    2839.136

.                 
.                 * Split sample on quintiles
.                 forval x = 2018/2019 {
  2.                 
.                         gen one_q1_`x' = base if year == `x' & base < ${q1_`x'} 
  3.                         gen one_q2_`x' = base if year == `x' & base >= ${q1_`x'} & bas
> e < ${q2_`x'}
  4.                         gen one_q3_`x' = base if year == `x' & base >= ${q2_`x'} & bas
> e < ${q3_`x'}
  5.                         gen one_q4_`x' = base if year == `x' & base >= ${q3_`x'} & bas
> e < ${q4_`x'}
  6.                         gen one_q5_`x' = base if year == `x' & base >= ${q4_`x'} & bas
> e < ${qmed_`x'}
  7.                 }       
(814,448 missing values generated)
(814,447 missing values generated)
(814,447 missing values generated)
(814,489 missing values generated)
(814,406 missing values generated)
(813,280 missing values generated)
(813,210 missing values generated)
(813,237 missing values generated)
(813,259 missing values generated)
(813,225 missing values generated)

. 
.                 forval x = 2018/2019 {
  2.                         gen lw_`x' = base if year == `x' & base < ${qmed_`x'}
  3.                 }
(455,149 missing values generated)
(449,123 missing values generated)

.                 
.                 * Collapse and estimate shares of income
.                 collapse (sum) one_q* lw_*

.                 
.                 forval x = 2018/2019 {
  2.                         forval q = 1/5 {
  3.                         
.                                 gen s_q`q'_`x' = (one_q`q'_`x'/lw_`x')*100
  4.                         }
  5.                 }       

.                 keep s_q*       

.                 
.                 gen ID = 1

.                 
.                 reshape long s_q1_ s_q2_ s_q3_ s_q4_ s_q5_, i(ID) j(year)
(note: j = 2018 2019)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                        1   ->       2
Number of variables                  11   ->       7
j variable (2 values)                     ->   year
xij variables:
                    s_q1_2018 s_q1_2019   ->   s_q1_
                    s_q2_2018 s_q2_2019   ->   s_q2_
                    s_q3_2018 s_q3_2019   ->   s_q3_
                    s_q4_2018 s_q4_2019   ->   s_q4_
                    s_q5_2018 s_q5_2019   ->   s_q5_
-----------------------------------------------------------------------------

.                 
.                 ren (s_q1_ s_q2_ s_q3_ s_q4_ s_q5_) (sq1 sq2 sq3 sq4 sq5)

.                 
.                 reshape long sq, i(year) j(q)
(note: j = 1 2 3 4 5)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                        2   ->      10
Number of variables                   7   ->       4
j variable (5 values)                     ->   q
xij variables:
                        sq1 sq2 ... sq5   ->   sq
-----------------------------------------------------------------------------

.                 
.                 gen sq18 = sq if year == 2018
(5 missing values generated)

.                 gen sq19 = sq if year == 2019
(5 missing values generated)

.                 
.                 label define q 1 "Q1" 2 "Q2" 3 "Q3" 4 "Q4" 5 "Q5"

.                 label values q q

.                 
.                 # d;
delimiter now ;
.                 graph bar (mean) sq18 sq19, 
>                                 over(q)
>                                 blabel(total, format(%12,1fc) position(inside) color(whit
> e))
>                                 ylabel(0(7.5)30, labsize(small)) 
>                                 graphregion(color(white))
>                                 ytitle("")
>                                 bar(1,color(blue))
>                                 bar(2,color(green))                     
>                                 legend(order(1 "2018" 2 "2019") size(small) r(1)
>                                 region(lstyle(none) color(none)));

.                 #d cr           
delimiter now cr
.                 graph export "$out\Figure 8.png", replace       
(file E:\Jorgec\ISEAK mw report 2022\01. Descriptives\out\Figure 8.png written in PNG forma
> t)

.         
.         restore 

. 
. ********************************************************************************
. * J. Figure 9
. ********************************************************************************
. 
.         * Prepare list of missing workers from previous waves   
.         preserve

.         
.                 use "$dta/00. Personal data 2017.dta", clear

. 
.                 merge 1:1 identpers using "$dta/00. Personal data 2018.dta"
(label cob2 already defined)
(label nat2 already defined)
(label sexo already defined)
(label edad_cat already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                       118,857
        from master                    49,453  (_merge==1)
        from using                     69,404  (_merge==2)

    matched                         1,178,490  (_merge==3)
    -----------------------------------------

. 
.                         qui unique identpers if _m == 1 & !mi(ffallec)

.                         di as txt "Number of workers who passed away in 2017 wave:" %5.0f
> c `r(unique)'          
Number of workers who passed away in 2017 wave:14036

. 
.                         qui unique identpers if _m == 1 & mi(ffallec)

.                         di as txt "Number of workers who dissapeared from 2017 wave:" %5.
> 0fc `r(unique)'                        
Number of workers who dissapeared from 2017 wave:35417

.                         
.                         keep if _m == 1 & mi(ffallec)
(1,261,930 observations deleted)

.                         
.                         gen base = 0                    

.                         gen year = 2018

.                         
.                         keep identpers year base

.                         
.                         tempfile old_wave_17

.                         save `old_wave_17', replace
(note: file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_00001p.tmp not found)
file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_00001p.tmp saved

.         
.         restore

.         preserve

.         
.                 use "$dta/00. Personal data 2018.dta", clear    

.         
.                 sort identpers 

.                 merge 1:1 identpers using "$dta/00. Personal data 2019.dta"
(label cob2 already defined)
(label nat2 already defined)
(label sexo already defined)
(label edad_cat already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                       117,388
        from master                    48,283  (_merge==1)
        from using                     69,105  (_merge==2)

    matched                         1,199,611  (_merge==3)
    -----------------------------------------

. 
.                         qui unique identpers if _m == 1 & !mi(ffallec)

.                         di as txt "Number of workers who passed away in 2018 wave:" %5.0f
> c `r(unique)'          
Number of workers who passed away in 2018 wave:14413

. 
.                         qui unique identpers if _m == 1 & mi(ffallec)

.                         di as txt "Number of workers who dissapeared from 2018 wave:" %5.
> 0fc `r(unique)'                        
Number of workers who dissapeared from 2018 wave:33870

.                         
.                         keep if _m == 1 & mi(ffallec)
(1,283,129 observations deleted)

.                         drop _m

. 
.                         gen base = 0                    

.                         gen year = 2019

.                         
.                         keep identpers year base                        

.                         
.                         tempfile old_wave_18

.                         save `old_wave_18', replace
(note: file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_00001r.tmp not found)
file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_00001r.tmp saved

.         
.         restore

.         
.                 * Estimate the share for each quintile of the half lowest distribution
.                 preserve

.                         
.                         keep if !mi(one_18) | !mi(one_19_nov) 
(14,284,704 observations deleted)

.                         append using `old_wave_17'

.                         append using `old_wave_18'

.                         
.                         forval x = 2018/2019 {
  2.                                 qui sum base if year == `x',d
  3.                                 global qmed_`x' = r(p50)                
  4. 
.                                 centile base if year == `x' & base < ${qmed_`x'}, c(20 40
>  60 80)
  5.                                 
.                                 global q1_`x' = r(c_1)
  6.                                 global q2_`x' = r(c_2)
  7.                                 global q3_`x' = r(c_3)
  8.                                 global q4_`x' = r(c_4)  
  9.                                 
.                         }

                                                       -- Binom. Interp. --
    Variable |       Obs  Percentile    Centile        [95% Conf. Interval]
-------------+-------------------------------------------------------------
        base |   242,270         20      387.39          381.09    395.4767
             |                   40       858.6           858.6       858.6
             |                   60     1122.66         1120.46     1125.11
             |                   80     1343.55            1342     1345.17

                                                       -- Binom. Interp. --
    Variable |       Obs  Percentile    Centile        [95% Conf. Interval]
-------------+-------------------------------------------------------------
        base |   244,542         20         433             425    440.2875
             |                   40     948.832             945    952.2495
             |                   60     1163.36         1160.87     1165.48
             |                   80    1378.868         1377.14     1380.48

.                         
.                         * Split sample on quintiles
.                         forval x = 2018/2019 {
  2.                         
.                                 gen one_q1_`x' = base if year == `x' & base < ${q1_`x'} 
  3.                                 gen one_q2_`x' = base if year == `x' & base >= ${q1_`x
> '} & base < ${q2_`x'}
  4.                                 gen one_q3_`x' = base if year == `x' & base >= ${q2_`x
> '} & base < ${q3_`x'}
  5.                                 gen one_q4_`x' = base if year == `x' & base >= ${q3_`x
> '} & base < ${q4_`x'}
  6.                                 gen one_q5_`x' = base if year == `x' & base >= ${q4_`x
> '} & base < ${qmed_`x'}
  7.                         }       
(925,107 missing values generated)
(928,793 missing values generated)
(921,408 missing values generated)
(925,124 missing values generated)
(925,093 missing values generated)
(924,652 missing values generated)
(924,649 missing values generated)
(924,631 missing values generated)
(924,670 missing values generated)
(924,651 missing values generated)

. 
.                         forval x = 2018/2019 {
  2.                                 gen lw_`x' = base if year == `x' & base < ${qmed_`x'}
  3.                         }
(731,289 missing values generated)
(729,017 missing values generated)

.                         
.                         * Collapse and estimate shares of income
.                         collapse (sum) one_q* lw_*

.                         
.                         forval x = 2018/2019 {
  2.                                 forval q = 1/5 {
  3.                                 
.                                         gen s_q`q'_`x' = (one_q`q'_`x'/lw_`x')*100
  4.                                 }
  5.                         }       

.                         keep s_q*       

.                         
.                         gen ID = 1

.                         
.                         reshape long s_q1_ s_q2_ s_q3_ s_q4_ s_q5_, i(ID) j(year)
(note: j = 2018 2019)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                        1   ->       2
Number of variables                  11   ->       7
j variable (2 values)                     ->   year
xij variables:
                    s_q1_2018 s_q1_2019   ->   s_q1_
                    s_q2_2018 s_q2_2019   ->   s_q2_
                    s_q3_2018 s_q3_2019   ->   s_q3_
                    s_q4_2018 s_q4_2019   ->   s_q4_
                    s_q5_2018 s_q5_2019   ->   s_q5_
-----------------------------------------------------------------------------

.                         
.                         ren (s_q1_ s_q2_ s_q3_ s_q4_ s_q5_) (sq1 sq2 sq3 sq4 sq5)

.                         
.                         reshape long sq, i(year) j(q)
(note: j = 1 2 3 4 5)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                        2   ->      10
Number of variables                   7   ->       4
j variable (5 values)                     ->   q
xij variables:
                        sq1 sq2 ... sq5   ->   sq
-----------------------------------------------------------------------------

.                         
.                         gen sq18 = sq if year == 2018
(5 missing values generated)

.                         gen sq19 = sq if year == 2019
(5 missing values generated)

.                         
.                         label define q 1 "Q1" 2 "Q2" 3 "Q3" 4 "Q4" 5 "Q5"

.                         label values q q

.                         
.                         # d;
delimiter now ;
.                         graph bar (mean) sq18 sq19, 
>                                         over(q)
>                                         blabel(total, format(%12,1fc) position(12) color(
> black))
>                                         ylabel(0(5)35, labsize(small)) 
>                                         graphregion(color(white))
>                                         ytitle("")
>                                         bar(1,color(blue))
>                                         bar(2,color(green))                     
>                                         legend(order(1 "2018" 2 "2019") size(small) r(1)
>                                         region(lstyle(none) color(none)));
(note:  named style 12 not found in class barlabelpos, default attributes used)
(note:  barlabelpos not found in scheme, default attributes used)

.                         #d cr           
delimiter now cr
.                         graph export "$out\Figure 9.png", replace       
(file E:\Jorgec\ISEAK mw report 2022\01. Descriptives\out\Figure 9.png written in PNG forma
> t)

. 
.         restore

.         
. ********************************************************************************
. * K. Figure 10 and Table 3
. ********************************************************************************         
>        
. 
.         * Prepare list of missing workers from previous waves   
.         preserve

.         
.                 use "$dta/00. Personal data 2017.dta", clear

. 
.                 merge 1:1 identpers using "$dta/00. Personal data 2018.dta"
(label cob2 already defined)
(label nat2 already defined)
(label sexo already defined)
(label edad_cat already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                       118,857
        from master                    49,453  (_merge==1)
        from using                     69,404  (_merge==2)

    matched                         1,178,490  (_merge==3)
    -----------------------------------------

. 
.                         qui unique identpers if _m == 1 & !mi(ffallec)

.                         di as txt "Number of workers who passed away in 2017 wave:" %5.0f
> c `r(unique)'          
Number of workers who passed away in 2017 wave:14036

. 
.                         qui unique identpers if _m == 1 & mi(ffallec)

.                         di as txt "Number of workers who dissapeared from 2017 wave:" %5.
> 0fc `r(unique)'                        
Number of workers who dissapeared from 2017 wave:35417

.                         
.                         keep if _m == 1 & mi(ffallec)
(1,261,930 observations deleted)

.                         
.                         gen renta = 0                   

.                         gen year = 2018

.                         
.                         keep identpers year renta sexo espanol menor_30

.                         
.                         tempfile old_wave_17

.                         save `old_wave_17', replace
(note: file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_00001u.tmp not found)
file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_00001u.tmp saved

.         
.         restore

.         preserve

.         
.                 use "$dta/00. Personal data 2018.dta", clear    

.         
.                 sort identpers 

.                 merge 1:1 identpers using "$dta/00. Personal data 2019.dta"
(label cob2 already defined)
(label nat2 already defined)
(label sexo already defined)
(label edad_cat already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                       117,388
        from master                    48,283  (_merge==1)
        from using                     69,105  (_merge==2)

    matched                         1,199,611  (_merge==3)
    -----------------------------------------

. 
.                         qui unique identpers if _m == 1 & !mi(ffallec)

.                         di as txt "Number of workers who passed away in 2018 wave:" %5.0f
> c `r(unique)'          
Number of workers who passed away in 2018 wave:14413

. 
.                         qui unique identpers if _m == 1 & mi(ffallec)

.                         di as txt "Number of workers who dissapeared from 2018 wave:" %5.
> 0fc `r(unique)'                        
Number of workers who dissapeared from 2018 wave:33870

.                         
.                         keep if _m == 1 & mi(ffallec)
(1,283,129 observations deleted)

.                         drop _m

. 
.                         gen renta = 0                   

.                         gen year = 2019

.                         
.                         keep identpers year renta sexo espanol menor_30

.                         
.                         tempfile old_wave_18

.                         save `old_wave_18', replace
(note: file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_00001w.tmp not found)
file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_00001w.tmp saved

.         
.         restore

.         
.         * Estimate the share for each quintile of the half lowest distribution
.         preserve

.                         
.                         keep if !mi(one_18) | !mi(one_19_nov) 
(14,284,704 observations deleted)

.                         append using `old_wave_17'
(label sexo already defined)

.                         append using `old_wave_18'
(label sexo already defined)

.                 
.                 replace renta = base if mi(renta)
(904,272 real changes made)

.                 
.                 forval x = 2018/2019 {
  2.                         qui sum base if year == `x',d
  3.                         global qmed_w_`x' = r(p50)                                    
>   
  4.                         
.                         qui sum renta if year == `x',d
  5.                         global qmed_r_`x' = r(p50)                                    
>                           
  6.                 }

.                 
.                 * Split sample on quintiles
.                 forval x = 2018/2019 {
  2.                         
.                         ** Total obs 
.                         gen one_1_`x' = base if year == `x' & base < ${qmed_w_`x'}
  3.                         gen one_4_`x' = renta if year == `x' & renta < ${qmed_r_`x'}
  4.                                 
.                         ** Social group
.                                 *** Women
.                                 gen bm_1_1_`x' = base if sexo == 1 & year == `x' & base <
>  ${qmed_w_`x'}
  5.                                 gen bm_4_1_`x' = renta if sexo == 1 & year == `x' & re
> nta < ${qmed_r_`x'}                       
  6. 
.                                 *** Foreign                     
.                                 gen bm_1_2_`x' = base if espanol == 0 & year == `x' & bas
> e < ${qmed_w_`x'}
  7.                                 gen bm_4_2_`x' = renta if espanol == 0 & year == `x' &
>  renta < ${qmed_r_`x'}                                            
  8.                                 
.                                 *** Less than 30y
.                                 gen bm_1_3_`x' = base if menor_30 == 1 & year == `x' & ba
> se < ${qmed_w_`x'}
  9.                                 gen bm_4_3_`x' = renta if menor_30 == 1 & year == `x' 
> & renta < ${qmed_r_`x'}                                                                  
>  
 10.                 }       
(748,994 missing values generated)
(731,289 missing values generated)
(849,097 missing values generated)
(837,254 missing values generated)
(941,203 missing values generated)
(930,109 missing values generated)
(914,824 missing values generated)
(906,223 missing values generated)
(745,985 missing values generated)
(729,017 missing values generated)
(846,832 missing values generated)
(835,281 missing values generated)
(937,945 missing values generated)
(927,621 missing values generated)
(908,290 missing values generated)
(898,949 missing values generated)

. 
.                 * Collapse and estimate shares of income
.                 collapse (sum) one_* bm_*

.                 
.                 forval x = 2018/2019 {
  2.                         foreach source in 1 4 {
  3.                                 foreach catvar in 1 2 3 {
  4.                                         gen s_`source'_`catvar'_`x' = (bm_`source'_`ca
> tvar'_`x'/one_`source'_`x')*100
  5.                                 }
  6.                         }
  7.                 }       

.                 
.                 keep s_*        

.                 
.                 gen ID = 1

.                 
.                 reshape long s_1_1_ s_1_2_ s_1_3_ s_4_1_ s_4_2_ s_4_3_, i(ID) j(year)
(note: j = 2018 2019)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                        1   ->       2
Number of variables                  13   ->       8
j variable (2 values)                     ->   year
xij variables:
                  s_1_1_2018 s_1_1_2019   ->   s_1_1_
                  s_1_2_2018 s_1_2_2019   ->   s_1_2_
                  s_1_3_2018 s_1_3_2019   ->   s_1_3_
                  s_4_1_2018 s_4_1_2019   ->   s_4_1_
                  s_4_2_2018 s_4_2_2019   ->   s_4_2_
                  s_4_3_2018 s_4_3_2019   ->   s_4_3_
-----------------------------------------------------------------------------

.                 
.                 ren (s_1_1_ s_1_2_ s_1_3_ s_4_1_ s_4_2_ s_4_3_) (s1_1 s1_2 s1_3 s4_1 s4_2
>  s4_3)

.                 
.                 reshape long s1_ s4_, i(ID year) j(type)
(note: j = 1 2 3)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                        2   ->       6
Number of variables                   8   ->       5
j variable (3 values)                     ->   type
xij variables:
                         s1_1 s1_2 s1_3   ->   s1_
                         s4_1 s4_2 s4_3   ->   s4_
-----------------------------------------------------------------------------

. 
.                 label define type 1 "Mujeres" 2 "Extranjeros" 3 "Jóvenes"

.                 label values type type 

. 
.                 ren (s1_ s4_) (s1 s4)

.                 
.                 reshape long s, i(ID year type) j(income)               
(note: j = 1 4)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                        6   ->      12
Number of variables                   5   ->       5
j variable (2 values)                     ->   income
xij variables:
                                  s1 s4   ->   s
-----------------------------------------------------------------------------

.                 
.                 label define income 1 "Salarios" 4 "Rentas"

.                 label values income income 

.                 
.                 gen s18 = s if year == 2018 
(6 missing values generated)

.                 gen s19 = s if year == 2019
(6 missing values generated)

.                 
.                 gen s18_lab = string(s18, "%10,1fc")

.                 gen s19_lab = string(s19, "%10,1fc")

.                 
.                 gen income2 = income + 0.9

.                 
.                 ** Plot
.                 
.                         *** Women
.                         # d;
delimiter now ;
.                         twoway (bar s18 income if type == 1, barw(0.8) bcolor(blue))
>                                         (bar s19 income2 if type == 1, barw(0.8) bcolor(g
> reen))
>                                         (scatter s18 income if type == 1, mlabel(s18_lab)
>  mlabcolor(black) mlabpos(12) mcolor(none))
>                                         (scatter s19 income2 if type == 1, mlabel(s19_lab
> ) mlabcolor(black) mlabpos(12) mcolor(none)),
>                                         xlabel(1.5 "Salarios" 2.5 " " 3.5 " " 4.5 "Rentas
> " 5.5 " ")
>                                         graphregion(color(white))
>                                         ytitle("")
>                                         ylabel(45(2)55)
>                                         legend(order(1 "2018" 2 "2019") size(small) r(1)
>                                         region(lstyle(none) color(none)))
>                                         title("Mujeres")
>                                         name(g1, replace);

.                         #d cr                           
delimiter now cr
. 
.                         *** Foreign
.                         # d;
delimiter now ;
.                         twoway (bar s18 income if type == 2, barw(0.8) bcolor(blue))
>                                         (bar s19 income2 if type == 2, barw(0.8) bcolor(g
> reen))
>                                         (scatter s18 income if type == 2, mlabel(s18_lab)
>  mlabcolor(black) mlabpos(12) mcolor(none))
>                                         (scatter s19 income2 if type == 2, mlabel(s19_lab
> ) mlabcolor(black) mlabpos(12) mcolor(none)),
>                                         xlabel(1.5 "Salarios" 2.5 " " 3.5 " " 4.5 "Rentas
> " 5.5 " ")
>                                         graphregion(color(white))
>                                         ytitle("")
>                                         ylabel(11(1)16)
>                                         legend(order(1 "2018" 2 "2019") size(small) r(1)
>                                         region(lstyle(none) color(none)))
>                                         title("Extranjeros")
>                                         name(g2, replace);

.                         #d cr                           
delimiter now cr
.                                 
.                         *** Less than 30 years old
.                         # d;
delimiter now ;
.                         twoway (bar s18 income if type == 3, barw(0.8) bcolor(blue))
>                                         (bar s19 income2 if type == 3, barw(0.8) bcolor(g
> reen))
>                                         (scatter s18 income if type == 3, mlabel(s18_lab)
>  mlabcolor(black) mlabpos(12) mcolor(none))
>                                         (scatter s19 income2 if type == 3, mlabel(s19_lab
> ) mlabcolor(black) mlabpos(12) mcolor(none)),
>                                         xlabel(1.5 "Salarios" 2.5 " " 3.5 " " 4.5 "Rentas
> " 5.5 " ")
>                                         graphregion(color(white))
>                                         ytitle("")
>                                         ylabel(23(1)28)
>                                         legend(order(1 "2018" 2 "2019") size(small) r(1)
>                                         region(lstyle(none) color(none)))
>                                         title("Jóvenes")
>                                         name(g3, replace);

.                         #d cr                                                           
delimiter now cr
.                         
.                         *** Combine
.                         #d;
delimiter now ;
.                         grc1leg g1 g2 g3,
>                                 legendfrom(g1)
>                                 r(1)    
>                                 graphregion(color(white));

.                                                 # d cr          
delimiter now cr
.                         graph export "$out\Figure 10.png", replace      
(file E:\Jorgec\ISEAK mw report 2022\01. Descriptives\out\Figure 10.png written in PNG form
> at)

.                 
.                 graph drop _all

.         
.         restore 

. 
. ********************************************************************************
. * L. Figure 11 and Table 3
. ********************************************************************************         
>                
.         
.         * Prepare list of missing workers from previous waves   
.         preserve

.         
.                 use "$dta/00. Personal data 2017.dta", clear

. 
.                 merge 1:1 identpers using "$dta/00. Personal data 2018.dta"
(label cob2 already defined)
(label nat2 already defined)
(label sexo already defined)
(label edad_cat already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                       118,857
        from master                    49,453  (_merge==1)
        from using                     69,404  (_merge==2)

    matched                         1,178,490  (_merge==3)
    -----------------------------------------

. 
.                         qui unique identpers if _m == 1 & !mi(ffallec)

.                         di as txt "Number of workers who passed away in 2017 wave:" %5.0f
> c `r(unique)'          
Number of workers who passed away in 2017 wave:14036

. 
.                         qui unique identpers if _m == 1 & mi(ffallec)

.                         di as txt "Number of workers who dissapeared from 2017 wave:" %5.
> 0fc `r(unique)'                        
Number of workers who dissapeared from 2017 wave:35417

.                         
.                         keep if _m == 1 & mi(ffallec)
(1,261,930 observations deleted)

.                         
.                         gen renta = 0                   

.                         gen year = 2018

.                         
.                         keep identpers year renta sexo espanol menor_30

.                         
.                         tempfile old_wave_17

.                         save `old_wave_17', replace
(note: file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_000021.tmp not found)
file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_000021.tmp saved

.         
.         restore

.         preserve

.         
.                 use "$dta/00. Personal data 2018.dta", clear    

.         
.                 sort identpers 

.                 merge 1:1 identpers using "$dta/00. Personal data 2019.dta"
(label cob2 already defined)
(label nat2 already defined)
(label sexo already defined)
(label edad_cat already defined)

    Result                           # of obs.
    -----------------------------------------
    not matched                       117,388
        from master                    48,283  (_merge==1)
        from using                     69,105  (_merge==2)

    matched                         1,199,611  (_merge==3)
    -----------------------------------------

. 
.                         qui unique identpers if _m == 1 & !mi(ffallec)

.                         di as txt "Number of workers who passed away in 2018 wave:" %5.0f
> c `r(unique)'          
Number of workers who passed away in 2018 wave:14413

. 
.                         qui unique identpers if _m == 1 & mi(ffallec)

.                         di as txt "Number of workers who dissapeared from 2018 wave:" %5.
> 0fc `r(unique)'                        
Number of workers who dissapeared from 2018 wave:33870

.                         
.                         keep if _m == 1 & mi(ffallec)
(1,283,129 observations deleted)

.                         drop _m

. 
.                         gen renta = 0                   

.                         gen year = 2019

.                         
.                         keep identpers year renta sexo espanol menor_30

.                         
.                         tempfile old_wave_18

.                         save `old_wave_18', replace
(note: file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_000023.tmp not found)
file C:\ProgramData\Temp\stata-server\jorge_tmp\ST_1db8_000023.tmp saved

.         
.         restore

.         
.         * Estimate the share for each quintile of the half lowest distribution
.         preserve                

.                         keep if !mi(one_18) | !mi(one_19_nov) 
(14,284,704 observations deleted)

.                         append using `old_wave_17'
(label sexo already defined)

.                         append using `old_wave_18'
(label sexo already defined)

.                 
.                 replace renta = base if mi(renta)
(904,272 real changes made)

.                 
.                 forval x = 2018/2019 {
  2.                         qui sum base if year == `x',d
  3.                         global qmed_w_`x' = r(p50)                                    
>   
  4.                         
.                         qui sum renta if year == `x',d
  5.                         global qmed_r_`x' = r(p50)                                    
>                           
  6.                 }

.                 
.                 * Split sample on quintiles
.                 forval x = 2018/2019 {
  2.                         
.                         ** Total obs 
.                         gen one_1_`x' = base if year == `x' & base < ${qmed_w_`x'}
  3.                         gen one_4_`x' = renta if year == `x' & renta < ${qmed_r_`x'}
  4.                                 
.                         ** Social group
.                         
.                                 *** Men
.                                 gen bm_1_10_`x' = base if sexo == 0 & year == `x' & base 
> < ${qmed_w_`x'}
  5.                                 gen bm_4_10_`x' = renta if sexo == 0 & year == `x' & r
> enta < ${qmed_r_`x'}                      
  6.                         
.                                 *** Women
.                                 gen bm_1_11_`x' = base if sexo == 1 & year == `x' & base 
> < ${qmed_w_`x'}
  7.                                 gen bm_4_11_`x' = renta if sexo == 1 & year == `x' & r
> enta < ${qmed_r_`x'}                      
  8. 
.                                 *** Spanish             
.                                 gen bm_1_20_`x' = base if espanol == 1 & year == `x' & ba
> se < ${qmed_w_`x'}
  9.                                 gen bm_4_20_`x' = renta if espanol == 1 & year == `x' 
> & renta < ${qmed_r_`x'}                                                                  
>          
 10.                                 
.                                 *** Foreign                     
.                                 gen bm_1_21_`x' = base if espanol == 0 & year == `x' & ba
> se < ${qmed_w_`x'}
 11.                                 gen bm_4_21_`x' = renta if espanol == 0 & year == `x' 
> & renta < ${qmed_r_`x'}                                           
 12.                                 
.                                 *** More than 30y
.                                 gen bm_1_30_`x' = base if menor_30 == 0 & year == `x' & b
> ase < ${qmed_w_`x'}
 13.                                 gen bm_4_30_`x' = renta if menor_30 == 0 & year == `x'
>  & renta < ${qmed_r_`x'}                                                                 
>                                  
 14.                                                 
.                                 *** Less than 30y
.                                 gen bm_1_31_`x' = base if menor_30 == 1 & year == `x' & b
> ase < ${qmed_w_`x'}
 15.                                 gen bm_4_31_`x' = renta if menor_30 == 1 & year == `x'
>  & renta < ${qmed_r_`x'}          
 16.                                 
.                         ** Gaps
.                         
.                                 *** Gender
.                                 foreach source in 1 4 {
 17.                                         qui sum bm_`source'_10_`x'
 18.                                         local men = r(mean)
 19.                                 
.                                         qui sum bm_`source'_11_`x'
 20.                                         local women = r(mean)                         
>   
 21.                                 
.                                         gen gap_gend_`source'_`x' = ((`women'-`men')/`men
> ')*100*(-1)
 22.                                 }       
 23.                                 
.                                 *** Citizenship
.                                 foreach source in 1 4 {
 24.                                         qui sum bm_`source'_21_`x'
 25.                                         local foreign = r(mean)
 26.                                 
.                                         qui sum bm_`source'_20_`x'
 27.                                         local spanish = r(mean)                       
>   
 28.                                 
.                                         gen gap_citizen_`source'_`x' = ((`foreign'-`spani
> sh')/`spanish')*100*(-1)
 29.                                 }       
 30.                                 
.                                 *** Age
.                                 foreach source in 1 4 {
 31.                                         qui sum bm_`source'_31_`x'
 32.                                         local less_30 = r(mean)
 33.                                 
.                                         qui sum bm_`source'_30_`x'
 34.                                         local more_30 = r(mean)                       
>   
 35.                                 
.                                         gen gap_age_`source'_`x' = ((`less_30'-`more_30')
> /`more_30')*100*(-1)
 36.                                 }                                       
 37.                                 
.                 }       
(748,994 missing values generated)
(731,289 missing values generated)
(873,456 missing values generated)
(867,594 missing values generated)
(849,097 missing values generated)
(837,254 missing values generated)
(781,350 missing values generated)
(774,739 missing values generated)
(941,203 missing values generated)
(930,109 missing values generated)
(807,729 missing values generated)
(798,625 missing values generated)
(914,824 missing values generated)
(906,223 missing values generated)
(745,985 missing values generated)
(729,017 missing values generated)
(872,712 missing values generated)
(867,295 missing values generated)
(846,832 missing values generated)
(835,281 missing values generated)
(781,599 missing values generated)
(774,955 missing values generated)
(937,945 missing values generated)
(927,621 missing values generated)
(811,254 missing values generated)
(803,627 missing values generated)
(908,290 missing values generated)
(898,949 missing values generated)

. 
.                 * Collapse and estimate shares of income
.                 collapse (sum) one_* bm_* (mean) gap_*

.                 
.                 forval x = 2018/2019 {
  2.                         foreach source in 1 4 {
  3.                                 foreach catvar in 10 11 20 21 30 31 {
  4.                                         gen s_`source'_`catvar'_`x' = (bm_`source'_`ca
> tvar'_`x'/one_`source'_`x')*100
  5.                                 }
  6.                         }
  7.                 }       

.                 
.                 keep s_* gap_*  

.                 
.                 gen ID = 1

.                 
.                 reshape long s_1_10_ s_1_11_ s_1_20_ s_1_21_ s_1_30_ s_1_31_ s_4_10_ ///
>                                         s_4_11_ s_4_20_ s_4_21_ s_4_30_ s_4_31_ gap_gend_
> 1_ ///
>                                         gap_citizen_1_ gap_age_1_ gap_gend_4_ gap_citizen
> _4_ gap_age_4_ ///
>                                         , i(ID) j(year)
(note: j = 2018 2019)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                        1   ->       2
Number of variables                  37   ->      20
j variable (2 values)                     ->   year
xij variables:
                s_1_10_2018 s_1_10_2019   ->   s_1_10_
                s_1_11_2018 s_1_11_2019   ->   s_1_11_
                s_1_20_2018 s_1_20_2019   ->   s_1_20_
                s_1_21_2018 s_1_21_2019   ->   s_1_21_
                s_1_30_2018 s_1_30_2019   ->   s_1_30_
                s_1_31_2018 s_1_31_2019   ->   s_1_31_
                s_4_10_2018 s_4_10_2019   ->   s_4_10_
                s_4_11_2018 s_4_11_2019   ->   s_4_11_
                s_4_20_2018 s_4_20_2019   ->   s_4_20_
                s_4_21_2018 s_4_21_2019   ->   s_4_21_
                s_4_30_2018 s_4_30_2019   ->   s_4_30_
                s_4_31_2018 s_4_31_2019   ->   s_4_31_
        gap_gend_1_2018 gap_gend_1_2019   ->   gap_gend_1_
  gap_citizen_1_2018 gap_citizen_1_2019   ->   gap_citizen_1_
          gap_age_1_2018 gap_age_1_2019   ->   gap_age_1_
        gap_gend_4_2018 gap_gend_4_2019   ->   gap_gend_4_
  gap_citizen_4_2018 gap_citizen_4_2019   ->   gap_citizen_4_
          gap_age_4_2018 gap_age_4_2019   ->   gap_age_4_
-----------------------------------------------------------------------------

.                 
.                 ren (s_1_10_ s_1_11_ s_1_20_ s_1_21_ s_1_30_ s_1_31_ s_4_10_ s_4_11_ ///
>                         s_4_20_ s_4_21_ s_4_30_ s_4_31_ gap_gend_1_ gap_citizen_1_ gap_ag
> e_1_ ///
>                         gap_gend_4_ gap_citizen_4_ gap_age_4_) (s1_10 s1_11 s1_20 s1_21 /
> //
>                         s1_30 s1_31 s4_10 s4_11 s4_20 s4_21 s4_30 s4_31 gap_gend1 ///
>                         gap_citizen1 gap_age1 gap_gend4 gap_citizen4 gap_age4)

.                 
.                 reshape long s1_ s4_, i(ID year) j(type)
(note: j = 10 11 20 21 30 31)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                        2   ->      12
Number of variables                  20   ->      11
j variable (6 values)                     ->   type
xij variables:
                  s1_10 s1_11 ... s1_31   ->   s1_
                  s4_10 s4_11 ... s4_31   ->   s4_
-----------------------------------------------------------------------------

. 
.                 label define type 10 "Hombres" 11 "Mujeres" 20 "Español" 21 "Extranjeros"
>  30 "Mayores de 30" 31 "Jóvenes"

.                 label values type type 

. 
.                 ren (s1_ s4_) (s1 s4)

.                 
.                 reshape long s gap_gend gap_citizen gap_age, i(ID year type) j(income)   
>        
(note: j = 1 4)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                       12   ->      24
Number of variables                  11   ->       8
j variable (2 values)                     ->   income
xij variables:
                                  s1 s4   ->   s
                    gap_gend1 gap_gend4   ->   gap_gend
              gap_citizen1 gap_citizen4   ->   gap_citizen
                      gap_age1 gap_age4   ->   gap_age
-----------------------------------------------------------------------------

.                 
.                 label define income 1 "Salarios" 4 "Rentas"

.                 label values income income 

.                 
.                 foreach var in gap_gend gap_citizen gap_age {
  2.                         gen `var'18 = `var' if year == 2018
  3.                         gen `var'18_lab = string(`var'18, "%10,1fc")
  4.                         
.                         gen `var'19 = `var' if year == 2019
  5.                         gen `var'19_lab = string(`var'19, "%10,1fc")                  
>   
  6.                 }
(12 missing values generated)
(12 missing values generated)
(12 missing values generated)
(12 missing values generated)
(12 missing values generated)
(12 missing values generated)

.                 
.                 gen income2 = income + 0.9

.                 
.                 ** Plot gaps
.                         *** Women
.                         # d;
delimiter now ;
.                         twoway (bar gap_gend18 income, barw(0.8) bcolor(blue))
>                                         (bar gap_gend19 income2, barw(0.8) bcolor(green))
>                                         (scatter gap_gend18 income, mlabel(gap_gend18_lab
> ) mlabcolor(black) mlabpos(12) mcolor(none))
>                                         (scatter gap_gend19 income2, mlabel(gap_gend19_la
> b) mlabcolor(black) mlabpos(12) mcolor(none)),
>                                         xlabel(1.5 "Salarios" 2.5 " " 3.5 " " 4.5 "Rentas
> " 5.5 " ")
>                                         graphregion(color(white))
>                                         ytitle("")
>                                         ylabel(0(4)16)
>                                         legend(order(1 "2018" 2 "2019") size(small) r(1)
>                                         region(lstyle(none) color(none)))
>                                         title("Mujeres")
>                                         name(g1, replace);

.                         #d cr                           
delimiter now cr
. 
.                         *** Foreign
.                         # d;
delimiter now ;
.                         twoway (bar gap_citizen18 income, barw(0.8) bcolor(blue))
>                                         (bar gap_citizen19 income2, barw(0.8) bcolor(gree
> n))
>                                         (scatter gap_citizen18 income, mlabel(gap_citizen
> 18_lab) mlabcolor(black) mlabpos(12) mcolor(none))
>                                         (scatter gap_citizen19 income2, mlabel(gap_citize
> n19_lab) mlabcolor(black) mlabpos(12) mcolor(none)),
>                                         xlabel(1.5 "Salarios" 2.5 " " 3.5 " " 4.5 "Rentas
> " 5.5 " ")
>                                         graphregion(color(white))
>                                         ytitle("")
>                                         ylabel(0(5)25)
>                                         legend(order(1 "2018" 2 "2019") size(small) r(1)
>                                         region(lstyle(none) color(none)))
>                                         title("Extranjeros")
>                                         name(g2, replace);

.                         #d cr                           
delimiter now cr
.                                 
.                         *** Less than 30 years old
.                         # d;
delimiter now ;
.                         twoway (bar gap_age18 income, barw(0.8) bcolor(blue))
>                                         (bar gap_age19 income2, barw(0.8) bcolor(green))
>                                         (scatter gap_age18 income, mlabel(gap_age18_lab) 
> mlabcolor(black) mlabpos(12) mcolor(none))
>                                         (scatter gap_age19 income2, mlabel(gap_age19_lab)
>  mlabcolor(black) mlabpos(12) mcolor(none)),
>                                         xlabel(1.5 "Salarios" 2.5 " " 3.5 " " 4.5 "Rentas
> " 5.5 " ")
>                                         graphregion(color(white))
>                                         ytitle("")
>                                         ylabel(0(3)12)
>                                         legend(order(1 "2018" 2 "2019") size(small) r(1)
>                                         region(lstyle(none) color(none)))
>                                         title("Jóvenes")
>                                         name(g3, replace);

.                         #d cr                                                           
delimiter now cr
.                         
.                         *** Combine
.                         #d;
delimiter now ;
.                         grc1leg g1 g2 g3,
>                                 legendfrom(g1)
>                                 r(1)    
>                                 graphregion(color(white));

.                                                 # d cr          
delimiter now cr
.                         graph export "$out\Figure 11.png", replace      
(file E:\Jorgec\ISEAK mw report 2022\01. Descriptives\out\Figure 11.png written in PNG form
> at)

.                 
.                 graph drop _all         

.                 
.                 ** Export excel file
.                 label var year "Año"

.                 label var type "Colectivo"

.                 label var income "Tipo de ingreso"

.                 label var s "Composición (%)"

.                 
.                 export excel year type income s using "$out\Table 3.xlsx", replace first(
> varl)  
file E:\Jorgec\ISEAK mw report 2022\01. Descriptives\out\Table 3.xlsx saved

.         
.         restore

.         
. * End of this dofile
. cap log close
